<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Movie Recommendations</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {margin:0;background:#f7f8fa;font-family:'Roboto',Arial,sans-serif;color:#333;}
    .container {max-width:460px;margin:auto;padding:22px 7px 35px 7px;}
    h1 {text-align:center;color:#3e4ea1;font-size:1.8em;margin:7px 0 22px;}
    .rec-card {background:#fff;border-radius:12px;box-shadow:0 2px 16px #ccd0e8cc;padding:18px 16px 20px 16px;max-width:420px;margin:auto;}
    .form-group {margin-bottom:18px;}
    label {font-weight:500;margin-bottom:8px;display:block;}
    input[type="text"], select {
      width:100%;padding:.7em .5em;font-size:1em;border-radius:9px;border:1px solid #aec;color:#253;background:#f3f7fa;
    }
    .genre-list label {background:#e4eafa;color:#345;border-radius:9px;padding:5px 11px;margin:2px 7px 6px 0;cursor:pointer;font-size:.96em;display:inline-block;}
    .genre-list input[type="checkbox"] {accent-color:#4ec1ef;}
    .rec-btn {width:100%;padding:.72em;background:linear-gradient(90deg,#6493fa,#3e4ea1);color:#fff;font-size:1.07em;font-weight:700;border-radius:11px;border:none;cursor:pointer;box-shadow:0 1px 8px #20318c44;}
    .rec-btn:hover {box-shadow:0 2px 18px #2340aa23;transform:scale(1.03);}
    .results-section {margin-top:30px;}
    .results-header {margin-bottom:10px;font-size:1.07em;text-align:center;}
    .movie-list {display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px;}
    .movie-card {background:#fff;border-radius:10px;box-shadow:0 3px 12px #22223a33;padding:8px;text-align:center;}
    .movie-card img {width:93%;max-width:100px;border-radius:7px;background:#222;margin-bottom:6px;}
    .movie-title {font-weight:600;font-size:.97em;}
    .movie-meta {color:#aadcff;font-size:.94em;}
    .movie-genres {font-size:.93em;color:#49a;margin:3px 0 7px 0;}
    .pagination {text-align:center;margin:17px 0;}
    .pagination button {margin:0 10px;padding:6px 18px 7px;font-size:.97em;border-radius:9px;border:none;background:#3e4ea1;color:#fff;cursor:pointer;}
    .pagination button:disabled {background:#222;color:#aaa;}
    @media (max-width:500px) {.container{padding:5px;} .movie-card img{max-width:94px;} h1{font-size:1.22em;}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Movie Recommendations</h1>
    <div class="rec-card">
      <form id="recForm">
        <div class="form-group">
          <label for="name">Your Name</label>
          <input type="text" id="name" required autocomplete="off">
        </div>
        <div class="form-group">
          <label for="language">Preferred Movie Language</label>
          <select id="language" required>
            <option value="">Select language</option>
            <option value="en">English</option>
            <option value="ml">Malayalam</option>
            <option value="ta">Tamil</option>
            <option value="kn">Kannada</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="ja">Japanese</option>
            <option value="es">Spanish</option>
            <option value="bn">Bengali</option>
            <option value="mr">Marathi</option>
            <option value="te">Telugu</option>
            <option value="gu">Gujarati</option>
            <option value="pa">Punjabi</option>
            <option value="zh">Chinese</option>
          </select>
        </div>
        <div class="form-group">
          <label for="region">Preferred Region</label>
          <select id="region" required>
            <option value="IN">India</option>
            <option value="US">United States</option>
            <option value="JP">Japan</option>
            <option value="KR">Korea</option>
            <option value="GB">UK</option>
            <option value="ES">Spain</option>
            <option value="FR">France</option>
            <option value="CN">China</option>
            <option value="BR">Brazil</option>
            <option value="DE">Germany</option>
          </select>
        </div>
        <div class="form-group genre-list" id="genreList">
          <label>Genres</label>
          <div id="genresLoading">Loading genres...</div>
        </div>
        <button type="submit" class="rec-btn">Show Recommendations</button>
      </form>
    </div>

    <div id="resultsSection" class="results-section" style="display:none;">
      <div class="results-header">Hi <span id="userName"></span>! Showing <span id="userLang"></span> movies for <span id="userRegion"></span> in <span id="userGenres"></span></div>
      <div class="movie-list" id="movieList"></div>
      <div class="pagination">
        <button id="prevPage">Prev</button>
        <span id="pageNum">1</span>
        <button id="nextPage">Next</button>
      </div>
    </div>
  </div>
  <script>
    const TMDB_API_KEY = '55aa15967257accd7765c570a60be1be';
    const TMDB_API_BASE = 'https://api.themoviedb.org/3';
    let tmdbGenres = [];
    let currentLang = '', currentGenreIDs = [], currentPage = 1, lastTotalPages = 1, currentRegion = '';
    let currentLangName = '', currentRegionName = '', currentGenreNames = [];

    // Load genres
    async function loadGenres(){
      const res = await fetch(`${TMDB_API_BASE}/genre/movie/list?api_key=${TMDB_API_KEY}&language=en`);
      const data = await res.json();
      tmdbGenres = data.genres || [];
      genreList.innerHTML =
        tmdbGenres.map(g =>
          `<label><input type="checkbox" name="genre" value="${g.id}"> ${g.name}</label>`
        ).join('');
    }
    loadGenres();

    // Form submission handler
    document.getElementById('recForm').onsubmit = async function(e){
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      currentLang = document.getElementById('language').value;
      currentLangName = document.getElementById('language').selectedOptions[0].text;
      currentRegion = document.getElementById('region').value;
      currentRegionName = document.getElementById('region').selectedOptions.text;
      currentGenreIDs = Array.from(document.querySelectorAll('input[name="genre"]:checked')).map(cb=>cb.value);
      currentGenreNames = tmdbGenres.filter(g=>currentGenreIDs.includes(String(g.id))).map(g=>g.name);

      if(!name || !currentLang || !currentRegion || currentGenreIDs.length===0){
        alert("Please fill out all fields and select at least one genre."); return;
      }
      document.getElementById('recForm').parentElement.style.display = 'none';
      document.getElementById('resultsSection').style.display = '';
      document.getElementById('userName').innerText = name;
      document.getElementById('userLang').innerText = currentLangName;
      document.getElementById('userRegion').innerText = currentRegionName;
      document.getElementById('userGenres').innerText = currentGenreNames.join(', ');
      currentPage = 1;
      await loadRecommendations();
    };

    async function loadRecommendations(){
      let url = `${TMDB_API_BASE}/discover/movie?api_key=${TMDB_API_KEY}&region=${currentRegion}&sort_by=popularity.desc&with_genres=${currentGenreIDs.join(',')}&with_original_language=${currentLang}&language=en&page=${currentPage}`;
      let res = await fetch(url);
      let data = await res.json();
      let movies = data.results || [];
      lastTotalPages = data.total_pages || 1;
      document.getElementById('movieList').innerHTML =
        movies.map(movie=>`
          <div class="movie-card">
            <img src="${movie.poster_path?'https://image.tmdb.org/t/p/w500'+movie.poster_path:'https://via.placeholder.com/100x150?text=No+Image'}">
            <div class="movie-title">${movie.title}</div>
            <div class="movie-meta">${movie.release_date?movie.release_date.slice(0,4):''}</div>
            <div class="movie-genres">${(movie.genre_ids||[]).map(id=>tmdbGenres.find(g=>g.id==id)?.name).join('|')}</div>
          </div>`).join('');
      document.getElementById('pageNum').innerText = currentPage;
      document.getElementById('prevPage').disabled = currentPage<=1;
      document.getElementById('nextPage').disabled = currentPage>=lastTotalPages;
    }

    document.getElementById('prevPage').onclick = async function(){
      if(currentPage > 1){ currentPage--; await loadRecommendations();}
    };
    document.getElementById('nextPage').onclick = async function(){
      if(currentPage < lastTotalPages){ currentPage++; await loadRecommendations();}
    };
  </script>
</body>
</html>
