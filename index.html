<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Movie Recommendations</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0;
      font-family:'Roboto',Arial,sans-serif;
      color:#f2f4ff;
      background:linear-gradient(120deg, #2340a7 0%, #3e4ea1 50%, #3bb1df 100%);
      min-height:100vh;
    }
    .header-bar {
      max-width:460px; margin:0 auto; padding:19px 9px 0 9px; display:flex;align-items:center;
    }
    .home-btn {
      font-size:1.12em;
      color: #fff;
      background:linear-gradient(90deg,#4ec1ef,#3e4ea1);
      border:none;
      border-radius:11px;
      padding:7px 22px 7px 20px;
      box-shadow:0 2px 14px #285ad366;
      font-weight:700;
      cursor:pointer;
      margin-right:auto;
      transition:background .2s;
    }
    .home-btn:hover {
      background:linear-gradient(90deg,#3e4ea1,#4bbfed);
    }
    .container {
      max-width:460px;
      margin:auto;
      padding:10px 7px 38px 7px;
    }
    h1 {
      text-align:center;
      color:#fff;
      font-size:2em;
      margin:8px 0 28px;
      letter-spacing:2px;
      text-shadow:0 2px 14px #233c7d55;
    }
    .rec-card {
      background:rgba(255,255,255,0.09);
      border-radius:15px;
      box-shadow:0 3px 27px #24307033;
      padding:18px 16px 20px 16px;
      max-width:420px;
      margin:auto;
      backdrop-filter: blur(5px);
    }
    .form-group {margin-bottom:18px;}
    label {font-weight:500;margin-bottom:8px;display:block;}
    input[type="text"], select {
      width:100%;padding:.7em .5em;font-size:1em;border-radius:9px;border:none;
      margin-bottom:3px;
      background:#eaf3ff;
      color:#1a274d;
      box-shadow:0 1px 4px #22337a11;
    }
    .genre-list label {
      background:#395caa33;
      color:#f0fcff;
      border-radius:9px;
      padding:6px 13px;
      margin:2px 8px 8px 0;
      cursor:pointer;
      font-size:.97em;
      display:inline-block;
      box-shadow:0 1px 8px #488aae38;
      transition:background .2s;
    }
    .genre-list label:hover {
      background:#488acc66;
    }
    .genre-list input[type="checkbox"] {accent-color:#3bb1df;}
    .rec-btn {
      width:100%;padding:.76em;
      background:linear-gradient(90deg,#4ec1ef 0%,#3e4ea1 100%);
      color:#fff;
      font-size:1.13em;font-weight:700;border-radius:14px;border:none;
      cursor:pointer;box-shadow:0 2px 12px #2845a422;transition:background .2s;
    }
    .rec-btn:hover {background:linear-gradient(90deg,#3e4ea1 0%,#4bbfed 100%);}
    .results-section {margin-top:34px;}
    .results-header {
      margin-bottom:14px;
      font-size:1.11em;
      text-align:center;
      color:#e6ecff;
      text-shadow:0 1px 2px #25347022;
    }
    .movie-list {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
      gap:17px;
    }
    .movie-card {
      background:rgba(34,52,120,0.18);
      border-radius:13px;
      box-shadow:0 3px 18px #27458955;
      padding:9px 7px 15px 7px;
      text-align:center;
      color:#eaf0ff;
      transition:box-shadow .2s;
      cursor:pointer;
    }
    .movie-card:hover {box-shadow:0 8px 32px #2845a4aa;transform:scale(1.04);}
    .movie-card img {
      width:95%;max-width:102px;border-radius:8px;background:#29367c;
      margin-bottom:8px;box-shadow:0 1px 8px #488aae28;
    }
    .movie-title {font-weight:600;font-size:1em;color:#fff;}
    .movie-meta {color:#b3eaff;font-size:.97em;margin-top:2px;}
    .movie-genres {font-size:.93em;color:#51d1ff;margin:6px 0 7px 0;}
    .pagination {
      text-align:center;
      margin:22px 0;
    }
    .pagination button {
      margin:0 12px;
      padding:7px 24px 7px;
      font-size:1.03em;
      border-radius:12px;
      border:none;
      background:linear-gradient(90deg,#4ec1ef,#3e4ea1);
      color:#fff;
      cursor:pointer;
      box-shadow:0 1px 8px #25347022;
    }
    .pagination button:disabled {background:#222;color:#aaa;}

    /* Movie Modal */
    #movieModal {
      display:none;
      position:fixed;
      top:0; left:0;
      width:100vw; height:100vh;
      background:rgba(35,64,167,0.86);
      z-index:1000;
      align-items:center;
      justify-content:center;
    }
    #movieModal.show {
      animation: fadeIn .18s cubic-bezier(.55,.7,.55,1.2);
      display:flex;
    }
    @keyframes fadeIn {
      0% { opacity:0; }
      100% { opacity:1; }
    }
    #modalContent {
      background:linear-gradient(135deg,#315ab6 80%,#1a3564 100%);
      border-radius:21px;
      box-shadow:0 11px 48px #20318c55;
      padding:28px 22px 16px 22px;
      max-width:370px;
      width:94vw;
      color:#eaf2fd;
      margin:auto;
      transform: scale(0.7);
      animation: popIn .23s cubic-bezier(.43,1.5,.63,1.05);
    }
    @keyframes popIn {
      0% { transform:scale(.65);}
      80% { transform:scale(1.08);}
      100% { transform:scale(1);}
    }
    #modalPoster{
      width:100px;
      border-radius:13px;
      box-shadow: 0 2px 20px #1f2247aa;
      display:block;
      margin:0 auto 15px auto;
    }
    #modalTitle {font-size:1.13em; font-weight:700; color:#faffff; margin-bottom:10px;text-align:center;}
    #modalDesc {font-size:.98em; color:#e6f3ff; margin-bottom:16px; text-align:center;}
    #modalRating {font-size:1em; color:#fee16a; margin-bottom:11px; text-align:center;}
    #modalContent button {
      background:#4ec1ef;color:#fff;border:none;border-radius:10px;
      padding:9px 21px;font-size:1.07em;font-weight:600;margin-top:8px;cursor:pointer;width:100%;display:block;
      box-shadow:0 2px 8px #2845a440;transition:background .18s;
    }
    #modalContent button:hover {
      background:#3e4ea1;
    }
    @media (max-width:540px) {
      #modalContent {padding:17px 3vw;}
      #modalPoster{width:80px;}
    }
    /* Splash animation overlay */
    #splashScreen {
      position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:2000;
      background:linear-gradient(120deg, #2340a7 0%, #3e4ea1 60%, #3bb1df 100%);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      transition:opacity .45s;
    }
    #splashLogo {
      width:110px;
      box-shadow:0 2px 32px #20318c42;
      border-radius:24px;
      opacity:0;
      transform:scale(0.6) translateY(50px);
      filter:drop-shadow(0 4px 16px #3676a899);
    }
    #splashText {
      margin-top:25px;
      font-size:1.4em;
      letter-spacing:2px;
      font-weight:700;
      color:#fff;
      opacity:0;
      transform:scale(0.9);
      text-shadow:0 1px 10px #184faa65;
    }
  </style>
</head>
<body>
  <!-- Splash Animation -->
  <div id="splashScreen">
    <!-- Replace src with your real logo file if needed! -->
    <img id="splashLogo" src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/fba61ef8-279b-43f1-9875-1fdff1992488.png
" alt="The Movie DB Logo" />
    <div id="splashText">THE MOVIE DB</div>
  </div>

  <div class="header-bar">
    <button class="home-btn" id="homeBtn" onclick="goHome()">Home</button>
  </div>
  <div class="container">
    <h1>Movie Recommendations</h1>
    <div class="rec-card" id="recCard">
      <form id="recForm">
        <div class="form-group">
          <label for="name">Your Name</label>
          <input type="text" id="name" required autocomplete="off">
        </div>
        <div class="form-group">
          <label for="language">Preferred Movie Language</label>
          <select id="language" required>
            <option value="">Select language</option>
            <option value="en">English</option>
            <option value="ml">Malayalam</option>
            <option value="ta">Tamil</option>
            <option value="kn">Kannada</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="ja">Japanese</option>
            <option value="es">Spanish</option>
            <option value="bn">Bengali</option>
            <option value="mr">Marathi</option>
            <option value="te">Telugu</option>
            <option value="gu">Gujarati</option>
            <option value="pa">Punjabi</option>
            <option value="zh">Chinese</option>
          </select>
        </div>
        <div class="form-group">
          <label for="region">Preferred Region</label>
          <select id="region" required>
            <option value="IN">India</option>
            <option value="US">United States</option>
            <option value="JP">Japan</option>
            <option value="KR">Korea</option>
            <option value="GB">UK</option>
            <option value="ES">Spain</option>
            <option value="FR">France</option>
            <option value="CN">China</option>
            <option value="BR">Brazil</option>
            <option value="DE">Germany</option>
          </select>
        </div>
        <div class="form-group genre-list" id="genreList">
          <label>Genres</label>
          <div id="genresLoading">Loading genres...</div>
        </div>
        <button type="submit" class="rec-btn">Show Recommendations</button>
      </form>
    </div>

    <div id="resultsSection" class="results-section" style="display:none;">
      <div class="results-header">Hi <span id="userName"></span>! Showing <span id="userLang"></span> movies for <span id="userRegion"></span> in <span id="userGenres"></span></div>
      <div class="movie-list" id="movieList"></div>
      <div class="pagination">
        <button id="prevPage">Prev</button>
        <span id="pageNum">1</span>
        <button id="nextPage">Next</button>
      </div>
    </div>
  </div>

  <!-- Movie Detail Modal -->
  <div id="movieModal">
    <div id="modalContent">
      <img id="modalPoster" src="" alt="Poster" />
      <div id="modalTitle"></div>
      <div id="modalRating"></div>
      <div id="modalDesc"></div>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    // Splash animation logic
    window.addEventListener('DOMContentLoaded',()=>{
      const splash = document.getElementById('splashScreen');
      const logo = document.getElementById('splashLogo');
      const text = document.getElementById('splashText');

      setTimeout(()=>{
        logo.style.transition = 'transform .7s cubic-bezier(.77,-0.3,.35,1.45),opacity .56s';
        logo.style.opacity = '1';
        logo.style.transform = 'scale(1) rotate(360deg)';
      },120);

      setTimeout(()=>{
        text.style.transition = 'opacity .5s,.transform .4s';
        text.style.opacity = '1';
        text.style.transform = 'scale(1)';
      },490);

      setTimeout(()=>{
        splash.style.transition = 'opacity .6s cubic-bezier(.8,.2,.2,1)';
        splash.style.opacity = '0';
      },1900);

      setTimeout(()=>{ if(splash) splash.parentNode.removeChild(splash); }, 2500);
    });

    const TMDB_API_KEY = '55aa15967257accd7765c570a60be1be';
    const TMDB_API_BASE = 'https://api.themoviedb.org/3';
    let tmdbGenres = [];
    let currentLang = '', currentGenreIDs = [], currentPage = 1, lastTotalPages = 1, currentRegion = '';
    let currentLangName = '', currentRegionName = '', currentGenreNames = [];

    // Load genres
    async function loadGenres(){
      const res = await fetch(`${TMDB_API_BASE}/genre/movie/list?api_key=${TMDB_API_KEY}&language=en`);
      const data = await res.json();
      tmdbGenres = data.genres || [];
      genreList.innerHTML =
        tmdbGenres.map(g =>
          `<label><input type="checkbox" name="genre" value="${g.id}"> ${g.name}</label>`
        ).join('');
    }
    loadGenres();

    // Form submission handler
    document.getElementById('recForm').onsubmit = async function(e){
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      currentLang = document.getElementById('language').value;
      currentLangName = document.getElementById('language').selectedOptions[0].text;
      currentRegion = document.getElementById('region').value;
      currentRegionName = document.getElementById('region').selectedOptions.text;
      currentGenreIDs = Array.from(document.querySelectorAll('input[name="genre"]:checked')).map(cb=>cb.value);
      currentGenreNames = tmdbGenres.filter(g=>currentGenreIDs.includes(String(g.id))).map(g=>g.name);

      if(!name || !currentLang || !currentRegion || currentGenreIDs.length===0){
        alert("Please fill out all fields and select at least one genre."); return;
      }
      document.getElementById('recCard').style.display = 'none';
      document.getElementById('resultsSection').style.display = '';
      document.getElementById('userName').innerText = name;
      document.getElementById('userLang').innerText = currentLangName;
      document.getElementById('userRegion').innerText = currentRegionName;
      document.getElementById('userGenres').innerText = currentGenreNames.join(', ');
      currentPage = 1;
      await loadRecommendations();
    };

    async function loadRecommendations(){
      let url = `${TMDB_API_BASE}/discover/movie?api_key=${TMDB_API_KEY}&region=${currentRegion}&sort_by=popularity.desc&with_genres=${currentGenreIDs.join(',')}&with_original_language=${currentLang}&language=en&page=${currentPage}`;
      let res = await fetch(url);
      let data = await res.json();
      let movies = data.results || [];
      lastTotalPages = data.total_pages || 1;
      document.getElementById('movieList').innerHTML =
        movies.map(movie=>`
          <div class="movie-card" onclick="showModal('${escapeQuotes(movie.title)}','${escapeQuotes(movie.overview||"No description available.")}',${movie.vote_average||'0'},'${movie.poster_path?`https://image.tmdb.org/t/p/w500${movie.poster_path}`:''}')">
            <img src="${movie.poster_path?'https://image.tmdb.org/t/p/w500'+movie.poster_path:'https://via.placeholder.com/100x150?text=No+Image'}">
            <div class="movie-title">${movie.title}</div>
            <div class="movie-meta">${movie.release_date?movie.release_date.slice(0,4):''}</div>
            <div class="movie-genres">${(movie.genre_ids||[]).map(id=>tmdbGenres.find(g=>g.id==id)?.name).join('|')}</div>
          </div>`).join('');
      document.getElementById('pageNum').innerText = currentPage;
      document.getElementById('prevPage').disabled = currentPage<=1;
      document.getElementById('nextPage').disabled = currentPage>=lastTotalPages;
    }

    document.getElementById('prevPage').onclick = async function(){
      if(currentPage > 1){ currentPage--; await loadRecommendations();}
    };
    document.getElementById('nextPage').onclick = async function(){
      if(currentPage < lastTotalPages){ currentPage++; await loadRecommendations();}
    };

    // Home/Back button logic
    function goHome() {
      document.getElementById('recCard').style.display = '';
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('recForm').reset();
      Array.from(document.querySelectorAll('input[name="genre"]')).forEach(cb => cb.checked = false);
    }

    // Modal logic
    function escapeQuotes(str){
      return str ? str.replace(/'/g,"&#39;").replace(/"/g,"&quot;") : "";
    }

    function showModal(title, desc, rating, poster) {
      document.getElementById('modalPoster').src = poster || 'https://via.placeholder.com/100x150?text=No+Image';
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalRating').textContent = `TMDb Rating: ${rating} ⭐`;
      document.getElementById('modalDesc').textContent = desc;
      let modal = document.getElementById('movieModal');
      modal.classList.add('show');
      modal.style.display = "flex";
    }

    function closeModal(){
      let modal = document.getElementById('movieModal');
      modal.classList.remove('show');
      modal.style.display = "none";
    }
  </script>
</body>
</html>
