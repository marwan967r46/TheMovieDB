<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>TheMovieDB App</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {margin:0;font-family:'Roboto',Arial,sans-serif;background:#16161c;color:#fff;}
    h1 {text-align:center;letter-spacing:1px;color:#3e4ea1;margin:18px 0 8px;}
    .container {max-width:520px;margin:auto;padding:14px;background:rgba(34,34,52,0.94);border-radius:24px;box-shadow:0 6px 28px rgba(0,0,0,0.19);}
    .form-section {margin-bottom:18px;}
    .form-group {margin-bottom:11px;}
    label {display:block;font-weight:500;margin-bottom:6px;}
    input[type="text"], select {width:100%;padding:.8em .5em;font-size:1em;border-radius:13px;border:none;margin-bottom:8px;background:#dde6ff;color:#2a314d;}
    .genre-list label {display:inline-block;background:#253779;color:#dbeeff;border-radius:15px;padding:6px 14px;margin:3px 7px 8px 0;cursor:pointer;font-size:.97em;}
    .genre-list input[type="checkbox"] {accent-color:#4ec1ef;}
    button[type="submit"] {width:100%;padding:.8em;background:linear-gradient(90deg,#6493fa,#3e4ea1);color:#fff;font-size:1.08em;font-weight:700;border-radius:17px;border:none;cursor:pointer;box-shadow:0 1px 12px rgba(80,90,210,0.13);}
    button[type="submit"]:hover {box-shadow:0 3px 22px rgba(80,90,210,0.15);transform:scale(1.03);}
    .results-section {margin-top:18px;}
    .results-header {margin-bottom:8px;font-size:1.09em;}
    .movie-list {display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:16px;}
    .movie-card {background:linear-gradient(120deg,#232336 85%,#3e4ea1 100%);border-radius:14px;box-shadow:0 5px 28px rgba(20,25,80,0.22);padding:10px;text-align:center;cursor:pointer;}
    .movie-card img {width:95%;max-width:110px;border-radius:7px;background:#222;margin-bottom:6px;}
    .movie-title {font-weight:600;}
    .movie-meta {color:#aadcff;font-size:.94em;}
    .movie-overview {font-size:.92em;color:#d7e7ff;margin:7px 0 0;}
    .pagination {text-align:center;margin:18px 0;}
    .pagination button {margin:0 10px;padding:8px 24px 9px;font-size:1em;border-radius:14px;border:none;background:#3e4ea1;color:#fff;cursor:pointer;}
    .pagination button:disabled {background:#222;color:#aaa;}
    @media (max-width:600px) {.container {border-radius:14px;} .movie-card {min-width:110px;} h1 {font-size:1.17em;}}
  </style>
</head>
<body>
  <h1>TheMovieDB App</h1>
  <div class="container">
    <!-- Selection Form -->
    <form id="userForm" class="form-section">
      <div class="form-group">
        <label for="name">Your Name</label>
        <input type="text" id="name" required autocomplete="off">
      </div>
      <div class="form-group">
        <label for="language">Preferred Language (what language the movie is in)</label>
        <select id="language" required>
          <option value="">Select language</option>
          <option value="en">English</option>
          <option value="ml">Malayalam</option>
          <option value="ta">Tamil</option>
          <option value="kn">Kannada</option>
          <option value="hi">Hindi</option>
          <option value="ko">Korean</option>
          <option value="ja">Japanese</option>
          <option value="es">Spanish</option>
          <option value="bn">Bengali</option>
          <option value="mr">Marathi</option>
          <option value="te">Telugu</option>
          <option value="gu">Gujarati</option>
          <option value="pa">Punjabi</option>
          <option value="zh">Chinese</option>
        </select>
      </div>
      <div class="form-group">
        <label for="region">Preferred Region</label>
        <select id="region" required>
          <option value="IN">India</option>
          <option value="US">United States</option>
          <option value="JP">Japan</option>
          <option value="KR">Korea</option>
          <option value="GB">UK</option>
          <option value="ES">Spain</option>
          <option value="FR">France</option>
          <option value="CN">China</option>
          <option value="BR">Brazil</option>
          <option value="DE">Germany</option>
        </select>
      </div>
      <div class="form-group genre-list" id="genreList">
        <label style="font-size:1.01em;">Genres</label>
        <div id="genresLoading">Loading genres...</div>
      </div>
      <button type="submit">Get Recommendations</button>
    </form>

    <!-- Results with Pagination -->
    <div id="resultsSection" class="results-section" style="display:none;">
      <div class="results-header">Hi <span id="userName"></span>! Showing <span id="userLang"></span> movies for region <span id="userRegion"></span> in <span id="userGenres"></span></div>
      <div class="movie-list" id="movieList"></div>
      <div class="pagination">
        <button id="prevPage">Prev</button>
        <span id="pageNum">1</span>
        <button id="nextPage">Next</button>
      </div>
    </div>
  </div>
  <script>
    const TMDB_API_KEY = '55aa15967257accd7765c570a60be1be'; // <--- Put your API key here!
    const TMDB_API_BASE = 'https://api.themoviedb.org/3';

    let tmdbGenres = [];
    let currentLang = '', currentGenreIDs = [], currentPage = 1, lastTotalPages = 1, currentRegion = '';

    // Load genres on startup
    async function loadGenres(){
      const res = await fetch(`${TMDB_API_BASE}/genre/movie/list?api_key=${TMDB_API_KEY}&language=en`);
      const data = await res.json();
      tmdbGenres = data.genres || [];
      genreList.innerHTML = tmdbGenres.map(g =>
        `<label><input type="checkbox" name="genre" value="${g.id}"> ${g.name}</label>`
      ).join(' ');
    }
    loadGenres();

    // Form submission handler
    document.getElementById('userForm').onsubmit = async function(e){
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const language = document.getElementById('language').value;
      const langText = document.getElementById('language').selectedOptions[0].text;
      const region = document.getElementById('region').value;
      const regionText = document.getElementById('region').selectedOptions.text;
      const genreIDs = Array.from(document.querySelectorAll('input[name="genre"]:checked')).map(cb=>cb.value);
      const genreNames = tmdbGenres.filter(g=>genreIDs.includes(String(g.id))).map(g=>g.name);

      if(!name || !language || !region || genreIDs.length===0){
        alert("Please enter your name, select a language, region, and at least one genre."); return;
      }
      document.getElementById('userForm').style.display = 'none';
      document.getElementById('resultsSection').style.display = '';
      document.getElementById('userName').innerText=name;
      document.getElementById('userLang').innerText=langText;
      document.getElementById('userRegion').innerText=regionText;
      document.getElementById('userGenres').innerText=genreNames.join(', ');
      currentLang = language;
      currentRegion = region;
      currentGenreIDs = genreIDs;
      currentPage = 1;
      await loadRecommendations();
    };

    async function loadRecommendations(){
      // Use with_original_language for movie's production language
      let url = `${TMDB_API_BASE}/discover/movie?api_key=${TMDB_API_KEY}&region=${currentRegion}&sort_by=popularity.desc&with_genres=${currentGenreIDs.join(',')}&with_original_language=${currentLang}&language=en&page=${currentPage}`;
      let res = await fetch(url);
      let data = await res.json();
      let movies = data.results || [];
      lastTotalPages = data.total_pages || 1;
      document.getElementById('movieList').innerHTML =
        movies.map(movie=>`
          <div class="movie-card">
            <img src="${movie.poster_path?'https://image.tmdb.org/t/p/w500'+movie.poster_path:'https://via.placeholder.com/110x170?text=No+Image'}">
            <div class="movie-title">${movie.title}</div>
            <div class="movie-meta">${movie.release_date?movie.release_date.slice(0,4):''}</div>
            <div class="movie-overview">${movie.overview || ''}</div>
          </div>`).join('');
      document.getElementById('pageNum').innerText = currentPage;
      document.getElementById('prevPage').disabled = currentPage<=1;
      document.getElementById('nextPage').disabled = currentPage>=lastTotalPages;
    }

    document.getElementById('prevPage').onclick = async function(){
      if(currentPage > 1){ currentPage--; await loadRecommendations();}
    };
    document.getElementById('nextPage').onclick = async function(){
      if(currentPage < lastTotalPages){ currentPage++; await loadRecommendations();}
    };
  </script>
</body>
</html>
